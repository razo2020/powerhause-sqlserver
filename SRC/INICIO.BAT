@ECHO OFF

SETLOCAL ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION
REM DIR /S /O-N /B G:\CHIMU\PHD.QDC |FIND /V "DATA" > TEMP.TXT

REM ECHO %~dp0

REM G:
REM CD CHIMU\SISCAT\
SET "_INICIO=G:\CHIMU\SISCAT\"
COPY /V /Y ESTRUCT.QSS %_INICIO%

FOR /F %%G IN ('"DIR /S /O-N /B G:\CHIMU\PHD.QDC |FIND /V "DATA""') DO (
	ECHO %DATE% %TIME% %%G
	SET "_DIR=%%~dpG"	
	REM COPY /V /Y ESTRUCT.QSS !_DIR!
	PUSHD !_DIR!
		QSHOW AUTO="G:/CHIMU/SISCAT/ESTRUCT"
	POPD
	MKDIR TEMP%%~PG
	REM MOVE /Y %_INICIO%FILAS.TXT TEMP%%~PG
	REM MOVE /Y %_INICIO%ELEMENTO.TXT TEMP%%~PG
	REM MOVE /Y %_INICIO%RECORDS.TXT TEMP%%~PG
	MOVE /Y %_INICIO%QSHOGEN.QDS TEMP%%~PG
	REM DEL /Q /F !_DIR!ESTRUCT.QSS
	
	REM PUSHD TEMP%%~PG
		REM ECHO "BUILD" >> QSHOGEN.QDS
		REM ECHO "EXIT" >> QSHOGEN.QDS
		REM QDD AUTO=QSHOGEN
	REM POPD
) >> LOG.txt

DEL /Q /F %_INICIO%ESTRUCT.QSS

ENDLOCAL
EXIT/B

